# Тестовое задание e-Comet.io для Backend-разработчика

Данный репозиторий содержит моё решение тестовых заданий для позиции Backend Developer (Python+SQL) в e-Comet.io.

## Структура проекта

Проект организован в виде нескольких независимых модулей, каждый из которых соответствует определенной задаче:

```
TestTaskForEComet/
├── 1/                      # Задача 1: Менеджер подключений PostgreSQL
│   ├── .idea/              # Конфигурация IDE
│   ├── .venv/              # Виртуальное окружение
│   ├── core/               # Основная функциональность
│   │   ├── config/         # Управление конфигурацией
│   │   ├── exception/      # Пользовательские исключения
│   │   └── postgres/       # Интеграция с PostgreSQL
│   ├── .env                # Переменные окружения
│   ├── docker-compose.yaml # Docker-композиция
│   ├── Dockerfile          # Спецификация Docker-образа
│   ├── main.py             # Точка входа приложения
│   └── requirements.txt    # Зависимости
├── 2/                      # Задача 2: Парсер репозиториев GitHub
│   ├── .idea/              # Конфигурация IDE
│   ├── .venv/              # Виртуальное окружение
│   ├── core/               # Основная функциональность
│   │   └── config/         # Управление конфигурацией
│   ├── .env                # Переменные окружения
│   ├── main.py             # Точка входа приложения
│   └── requirements.txt    # Зависимости
├── 3/                      # Задача 3: Хранение данных в ClickHouse
│   ├── .idea/              # Конфигурация IDE
│   ├── .venv/              # Виртуальное окружение
│   ├── core/               # Основная функциональность
│   │   ├── config/         # Управление конфигурацией
│   │   └── repo/           # Интеграция с репозиторием
│   ├── .env                # Переменные окружения
│   ├── docker-compose.yaml # Docker-композиция
│   ├── Dockerfile          # Спецификация Docker-образа
│   ├── main.py             # Точка входа приложения
│   ├── requirements.txt    # Зависимости
│   └── tables.sql          # Определение схемы ClickHouse
├── 4/                      # Задача 4: SQL-запрос к ClickHouse
│   ├── .idea/              # Конфигурация IDE
│   └── table.sql           # Решение SQL-запроса
├── LICECE                  # Лицензия
├── README.md               # Описание проекта
└──  Описание задач.docx     # Документ с описанием задач
```

## Задача 1: Менеджер подключений PostgreSQL

Реализация FastAPI-приложения с пулом подключений к PostgreSQL, используя asyncpg.

### Особенности

- Асинхронное управление пулом подключений PostgreSQL
- Шаблон внедрения зависимостей для соединений с базой данных
- Конфигурация через переменные окружения
- Контейнеризация Docker для простоты развертывания

### Настройка и запуск

1. Настройте переменные окружения в файле `.env` или используйте предоставленные значения по умолчанию

2. Запустите с помощью Docker Compose:
   ```bash
   cd 1/
   docker-compose up -d
   ```

3. Доступ к API по адресу http://localhost:8000

### Эндпоинты

- `GET /db/version` - Возвращает версию сервера PostgreSQL

## Задача 2: Парсер репозиториев GitHub

Этот модуль асинхронно получает данные репозиториев из GitHub и предоставляет информацию о коммитах.

### Особенности

- Асинхронные запросы к API GitHub
- Ограничение скорости и контроль параллельности
- Модели данных с использованием Pydantic
- Настраиваемость через переменные окружения

### Настройка и запуск

1. Настройте переменные окружения в файле `.env`, включая ваш персональный токен доступа GitHub

2. Установите зависимости:
   ```bash
   cd 2/
   pip install -r requirements.txt
   ```

3. Запустите приложение:
   ```bash
   python main.py
   ```

### Детали реализации

Класс `GithubReposScrapper` получает информацию о коммитах с контролируемой скоростью запросов и параллельностью:

- Ограничивает максимальное количество одновременных запросов (MCR)
- Ограничивает количество запросов в секунду (RPS)
- Возвращает данные репозитория со списком авторов и количеством их коммитов за последний день

## Задача 3: Хранение данных в ClickHouse

Этот модуль расширяет Задачу 2, добавляя возможности хранения данных в ClickHouse для информации о репозиториях GitHub.

### Особенности

- Интеграция асинхронного клиента ClickHouse
- Эффективная пакетная вставка данных
- Контейнеризация Docker с ClickHouse
- Оптимизация использования памяти

### Настройка и запуск

1. Настройте переменные окружения в файле `.env`

2. Запустите с помощью Docker Compose:
   ```bash
   cd 3/
   docker-compose up -d
   ```

### Детали реализации

- Использует `aiochclient` для асинхронных операций с ClickHouse
- Реализует пакетную вставку данных для эффективного использования памяти
- Хранит данные о репозитории, его позиции в топе и коммитах авторов в таблицах ClickHouse

## Задача 4: SQL-запрос к ClickHouse

Эта задача предоставляет решение SQL-запроса для извлечения данных о просмотрах по фразам и часам из ClickHouse.

### SQL-решение

```sql
select phrase, groupArray((toHour(dt), views_diff)) as views_by_hour
from (
    select phrase, dt, views - neighbor(views, 1, views) as views_diff
    from phrases_views
    where campaign_id = 1111111
      and toDate(dt) = today()
    order by phrase, dt
)
group by phrase
```

### Формат вывода

Запрос возвращает данные в следующем формате:
```
phrase    views_by_hour
платье   [(15, 4), (14, 6), (13, 4), (12, 1)]
```

## Выполненные общие требования

- ✅ Python 3.11+
- ✅ Соответствие PEP8
- ✅ Обработка ошибок и меры безопасности
- ✅ Современные архитектурные паттерны
- ✅ Конфигурация через переменные окружения (без хардкода)
- ✅ Код, готовый к продакшену
- ✅ Независимые реализации задач
- ✅ Размещение на GitHub

## Используемые технологии

- **FastAPI**: Современный высокопроизводительный веб-фреймворк
- **asyncpg**: Асинхронный клиент PostgreSQL
- **aiochclient**: Асинхронный клиент ClickHouse
- **Pydantic**: Валидация данных и управление настройками
- **Docker & Docker Compose**: Контейнеризация и оркестрация
- **PostgreSQL**: Реляционная база данных
- **ClickHouse**: Колоночная СУБД для аналитических запросов

## Установка и разработка

### Предварительные требования

- Python 3.11+
- Docker и Docker Compose
- Git

### Клонирование репозитория

```bash
git clone https://github.com/вашеимя/TestTaskForEComet.git
cd TestTaskForEComet
```

### Запуск отдельных задач

См. конкретные инструкции в разделе каждой задачи выше.

## Лицензия

Этот проект лицензирован по лицензии MIT - см. файл LICENSE для получения подробной информации.